# ============================================================================
# Singularity Agent - Docker Compose
# ============================================================================
# Usage:
#   cp .env.example .env     # Configure your API keys
#   docker compose up        # Start agent
#   docker compose up -d     # Start in background
#   docker compose logs -f   # Follow logs
#   docker compose down      # Stop agent
#
# Scale multiple agents:
#   docker compose up --scale agent=3
# ============================================================================

services:
  agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: singularity-agent
    restart: unless-stopped

    # API keys and configuration from .env file
    env_file:
      - .env

    # Override agent settings (defaults in Dockerfile)
    environment:
      - AGENT_NAME=${AGENT_NAME:-Singularity}
      - AGENT_TICKER=${AGENT_TICKER:-SING}
      - AGENT_TYPE=${AGENT_TYPE:-general}
      - STARTING_BALANCE=${STARTING_BALANCE:-10.0}
      - LLM_PROVIDER=${LLM_PROVIDER:-anthropic}
      - LLM_MODEL=${LLM_MODEL:-claude-sonnet-4-20250514}
      - AGENT_DATA_DIR=/app/agent_data

    # Persist agent state across restarts
    volumes:
      - agent_data:/app/agent_data

    # Expose API port (if running Service API)
    ports:
      - "${API_PORT:-8000}:8000"

    # Resource limits to prevent runaway costs
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 2G
        reservations:
          cpus: "0.5"
          memory: 512M

    # Logging configuration
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  agent_data:
    driver: local
